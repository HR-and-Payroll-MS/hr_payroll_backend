Credential Recovery
======================================================================

Overview
----------------------------------------------------------------------
Autogenerated credentials (username, email, initial password) are cached so
that HR staff (Admin/Manager) can retrieve or regenerate them if the original
onboarding response is lost before delivery.

Cache & TTL
----------------------------------------------------------------------
- Cache key format: ``onboarding:cred:<user_id>``
- TTL (in minutes): ``ONBOARDING_CREDENTIAL_TTL_MINUTES`` (default 30)
- Stored fields:
  - ``username``
  - ``email``
  - ``initial_password``
  - ``created_at`` (ISO 8601, timezone-aware UTC)
  - ``regenerated`` (boolean, only present after regeneration)

Endpoints
----------------------------------------------------------------------
Retrieve (if within TTL):

.. code-block:: http

    GET /api/v1/employees/{employee_id}/initial-credentials/

Responses:
- ``200`` JSON with cached fields
- ``404`` Not found (expired or never cached)

Regenerate (invalidate previous password):

.. code-block:: http

    POST /api/v1/employees/{employee_id}/regenerate-credentials/

Responses:
- ``200`` JSON with new credentials (previous password no longer valid)

Security & Permissions
----------------------------------------------------------------------
- Restricted to Admin or Manager.
- Regular employees receive 403 (or 404 if object scoping prevents access).

Operational Notes
----------------------------------------------------------------------
- Only the initial password is rotated. Username/email remain unchanged.
- After TTL expiry, regeneration is still allowed (it creates a fresh cache entry).
- Consider increasing TTL in low-volume onboarding workflows if HR routinely needs longer retrieval windows.

Auditing
----------------------------------------------------------------------
If auditing sensitive operations, consider adding explicit log entries for
regeneration events (e.g., in a future enhancement).

Configuration Reference
----------------------------------------------------------------------
See :doc:`settings` for TTL configuration.
